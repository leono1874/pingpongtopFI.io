<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Pong Top Global</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            margin: 0;
            padding: 0;
            background-color: black;
            color: #f0f0f0;
        }
        h1 {
            text-align: center;
            color: #ffcc00;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            animation: glow 1.5s infinite alternate;
        }
        @keyframes glow {
            0% { text-shadow: 0 0 5px #ffcc00, 0 0 10px #ffcc00; }
            100% { text-shadow: 0 0 20px #ffcc00, 0 0 30px #ffcc00; }
        }
        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            background: rgba(50, 50, 50, 0.8);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.9);
            border-radius: 10px;
            border: 2px solid #ffcc00;
        }
        .form-group, .tournament-group {
            margin-bottom: 15px;
        }
        input[type="text"], button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-family: 'Press Start 2P', cursive;
        }
        button {
            background-color: #ffcc00;
            color: black;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #ffdb33;
        }
        #results, #ranking, #lastResults, #tournamentDiagram {
            margin-top: 20px;
        }
        .player {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .player img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .bronze { border: 2px solid #cd7f32; }
        .silver { border: 2px solid #c0c0c0; }
        .gold { border: 2px solid #ffd700; }
        #roster {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 20px;
        }
        #roster img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin: 5px;
        }
        .trophy {
            width: 20px;
            height: 20px;
            display: inline-block;
            background-color: gold;
            mask: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgZmlsbC1vcGFjaXR5PSJuYW1lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0yMC43NTUsMi43NTUgTDIwLjU1LDMuNDExIFoiIGZpbGw9ImdyZWVuIiBvcGFjaXR5PSJuYW1lIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWNhcGl0eD0iMSIgc3Ryb2tlLWRhcmtpbmVzPSIxMDAiLz48cGF0aCBkPSJNMTMuNTgsMTcuNjU2IEwxMy41OCwyMS4wMDMiIGZpbGw9ImdyZWVuIiBvcGFjaXR5PSJuYW1lIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgc3Ryb2tlLWNhcGl0eD0iMSIgc3Ryb2tlLWRhcmtpbmVzPSIxMDAiLz48cGF0aCBkPSJNMTUuMiwxOC45NzUgTDE1LjYzNSwxOC41NTAyIEwxNi40MDEsMTYuMjQ2MDUgTDE1LjYzNSwxNi41NzA3IEwxNC43NTUsMTUuMzYyMyBMMTYuNDEzLC45OTMwNyBMMTUuNTQ0LDE2LjY4MSBMMTQuMTY3LDE2LjU3NzcgTDEzLjQxLDE2LjU3NzcgTDEzLjQxLDE3LjY1MzMgTDIwLjk0LDE5LjA2NTg0IEwxOC42MzQsMTguMjU1IEwxOC4xNzY2LDE3LjU2MzkgTDE4LjM0OSwxNy42NjM4IEwxOC42MzQsMTguMjU1IEwxOC4xNzY2LDE3LjU2MzMgTDE4LjI0LDE3LjU2MzMgTDE4LjM0OSwxNy42NjM4IEwxOC43NjQ1LDE3LjU2MzMgTDE5Ljc4MywxOS4yMTg0IEwxNi45NDgsMTYuMTc5OTAgTDE2LjgzMDIsMTYuNzQ2IEwxNy42NTU4LDE3LjU2MzMgTDE4LjA1NCwxNi4xOTY5IEwxNy42NTUsMTUuNjk4MjIgTDE4LjA1NCwxNi4xOTY5IEwxNy42NTUsMTUuNjk4MjIgTDE4LjE3NiwxNy42NzU5IEwxNy4zNjQsMTUuNjk4MjIgTDE5LjQ2NiwxNi42NjU3IFoiLz48L3N2Zz4=');
            mask-size: contain;
            mask-repeat: no-repeat;
        }
        .tournament-group {
            display: none;
            margin-top: 20px;
        }
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            #roster img {
                width: 40px;
                height: 40px;
            }
        }
    </style>
    <!-- 1. Agregar la configuración de Firebase aquí -->
    <script src="https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
         	apiKey: "AIzaSyBWM83h2-wbLhMnGNDpKZ7Q2t9Zw0IGUew",
 	 	authDomain: "pingpong-3e477.firebaseapp.com",
  		projectId: "pingpong-3e477",
  		storageBucket: "pingpong-3e477.appspot.com",
  		messagingSenderId: "655838874020",
  		appId: "1:655838874020:web:f877ce89ca57b551075931",
  		measurementId: "G-C8T5PJDRYM"
        };
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
</head>
<body>

<div class="container">
    <h1>Ping Pong Top Global</h1>
    
    <div id="roster"></div>

    <h2>Registrar Jugador</h2>
    <div class="form-group">
        <input type="text" id="newPlayer" placeholder="Nombre del jugador">
        <input type="text" id="playerPhoto" placeholder="URL de la foto del jugador">
        <button onclick="addPlayer()">Agregar Jugador</button>
    </div>

    <h2>Registrar Partido</h2>
    <div class="form-group">
        <input type="text" id="winner" placeholder="Nombre del ganador">
        <input type="text" id="loser" placeholder="Nombre del perdedor">
        <input type="text" id="score" placeholder="Marcador (Ej. 3-1)">
        <button onclick="calculateElo()">Registrar Partido</button>
    </div>

    <h2>Últimos Resultados</h2>
    <div id="lastResults"></div>

    <h2>Ranking</h2>
    <div id="ranking"></div>

    <h2>Torneo</h2>
    <div class="tournament-group">
        <button onclick="startTournament()">Iniciar Torneo</button>
        <div id="tournamentDiagram"></div>
    </div>
    <button onclick="toggleTournament()">Mostrar/Ocultar Torneo</button>
</div>

<script>
    const players = {};

    // 2. Cargar jugadores de Firebase al cargar la página
    window.onload = function() {
        loadPlayers();
    };

    function loadPlayers() {
        database.ref('players').once('value', (snapshot) => {
            players = snapshot.val() || {};
            renderRoster();
            renderRanking();
        });
    }

    function addPlayer() {
        const playerName = document.getElementById("newPlayer").value;
        const playerPhoto = document.getElementById("playerPhoto").value;

        if (playerName && playerPhoto) {
            const playerId = playerName.toLowerCase().replace(/\s/g, "_");
            players[playerId] = { name: playerName, photo: playerPhoto, elo: 1200 };

            // 3. Guardar el jugador en Firebase
            database.ref('players/' + playerId).set(players[playerId]).then(() => {
                document.getElementById("newPlayer").value = '';
                document.getElementById("playerPhoto").value = '';
                renderRoster();
                renderRanking();
            });
        }
    }

    function calculateElo() {
        const winnerName = document.getElementById("winner").value.toLowerCase().replace(/\s/g, "_");
        const loserName = document.getElementById("loser").value.toLowerCase().replace(/\s/g, "_");
        const score = document.getElementById("score").value;

        if (players[winnerName] && players[loserName]) {
            const winnerElo = players[winnerName].elo;
            const loserElo = players[loserName].elo;

            const K = 32;
            const expectedWinner = 1 / (1 + Math.pow(10, (loserElo - winnerElo) / 400));
            const expectedLoser = 1 / (1 + Math.pow(10, (winnerElo - loserElo) / 400));

            players[winnerName].elo = Math.round(winnerElo + K * (1 - expectedWinner));
            players[loserName].elo = Math.round(loserElo + K * (0 - expectedLoser));

            // 4. Actualizar el Elo en Firebase
            database.ref('players/' + winnerName).update({ elo: players[winnerName].elo });
            database.ref('players/' + loserName).update({ elo: players[loserName].elo });

            document.getElementById("winner").value = '';
            document.getElementById("loser").value = '';
            document.getElementById("score").value = '';

            renderLastResults();
            renderRanking();
        }
    }

    function renderRoster() {
        const rosterDiv = document.getElementById("roster");
        rosterDiv.innerHTML = '';
        for (const playerId in players) {
            const player = players[playerId];
            const playerDiv = document.createElement("div");
            playerDiv.classList.add("player");
            playerDiv.innerHTML = `<img src="${player.photo}" alt="${player.name}"> ${player.name} (ELO: ${player.elo})`;
            rosterDiv.appendChild(playerDiv);
        }
    }

    function renderRanking() {
        const rankingDiv = document.getElementById("ranking");
        rankingDiv.innerHTML = '';
        const sortedPlayers = Object.values(players).sort((a, b) => b.elo - a.elo);
        sortedPlayers.forEach(player => {
            const playerDiv = document.createElement("div");
            playerDiv.classList.add("player");
            playerDiv.innerHTML = `<img src="${player.photo}" alt="${player.name}"> ${player.name} (ELO: ${player.elo})`;
            rankingDiv.appendChild(playerDiv);
        });
    }

    function renderLastResults() {
        const lastResultsDiv = document.getElementById("lastResults");
        lastResultsDiv.innerHTML = 'Últimos resultados registrados: ';

        function startTournament() {
    const playerIds = Object.keys(players);
    const shuffledPlayers = playerIds.sort(() => Math.random() - 0.5); // Mezcla los jugadores

    const tournamentPairs = [];
    for (let i = 0; i < shuffledPlayers.length; i += 2) {
        if (shuffledPlayers[i + 1]) {
            tournamentPairs.push([shuffledPlayers[i], shuffledPlayers[i + 1]]);
        }
    }

    const tournamentDiagramDiv = document.getElementById("tournamentDiagram");
    tournamentDiagramDiv.innerHTML = '';
    tournamentPairs.forEach(pair => {
        const player1 = players[pair[0]];
        const player2 = players[pair[1]];
        tournamentDiagramDiv.innerHTML += `<div>${player1.name} vs ${player2.name}</div>`;
    });
}
    }

    function toggleTournament() {
        const tournamentGroup = document.querySelector('.tournament-group');
        tournamentGroup.style.display = tournamentGroup.style.display === 'block' ? 'none' : 'block';
    }

    function startTournament() {
        // Aquí puedes añadir el código para iniciar un torneo y emparejar jugadores al azar
        const tournamentDiagramDiv = document.getElementById("tournamentDiagram");
        tournamentDiagramDiv.innerHTML = 'Diagrama del torneo aparecerá aquí.';
    }
</script>
</body>
</html>